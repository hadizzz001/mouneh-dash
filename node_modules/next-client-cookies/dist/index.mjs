import {
  __name
} from "./chunk-G5GHKT7C.mjs";

// src/provider.tsx
import React, { createContext, useContext, useEffect, useMemo } from "react";
import jsCookies from "js-cookie";
import { ServerInsertedHTMLContext } from "next/navigation";
var Ctx = /* @__PURE__ */ createContext(null);
var useCookies = /* @__PURE__ */ __name(() => {
  const cookies = useContext(Ctx);
  if (typeof window !== "undefined") {
    return jsCookies;
  }
  if (!cookies) {
    throw new Error("Missing <CookiesProvider>");
  }
  return cookies;
}, "useCookies");
var windowVarName = "__cookies_commands";
var CookiesProvider = /* @__PURE__ */ __name(({ value, children }) => {
  const insertedHTML = useContext(ServerInsertedHTMLContext);
  const cookies = useMemo(() => {
    const map = Object.fromEntries(value.map((c) => [
      c.name,
      c.value
    ]));
    return {
      get: (name) => name == null ? {
        ...map
      } : map[name],
      set: (...args) => {
        insertedHTML?.(() => getCookieCommandHtml("set", ...args));
        map[args[0]] = args[1];
      },
      remove: (...args) => {
        insertedHTML?.(() => getCookieCommandHtml("remove", ...args));
        delete map[args[0]];
      }
    };
  }, [
    value,
    insertedHTML
  ]);
  useEffect(() => {
    const commands = window[windowVarName] || [];
    if (!commands.length)
      return;
    for (const command of commands) {
      runCookieCommand(command);
    }
  }, []);
  return /* @__PURE__ */ React.createElement(Ctx.Provider, {
    value: cookies
  }, children);
}, "CookiesProvider");
var getCookieCommandHtml = /* @__PURE__ */ __name((...command) => /* @__PURE__ */ React.createElement("script", {
  dangerouslySetInnerHTML: {
    __html: `window.${windowVarName} = window.${windowVarName} || [];window.${windowVarName}.push(${JSON.stringify(command).replaceAll("</", "<\\/")});`
  }
}), "getCookieCommandHtml");
var runCookieCommand = /* @__PURE__ */ __name((command) => {
  if (typeof window === "undefined")
    return;
  switch (command[0]) {
    case "set": {
      jsCookies.set(command[1], command[2], command[3] && deserializeCookieAttributes(command[3]));
      break;
    }
    case "remove": {
      jsCookies.remove(command[1], command[2] && deserializeCookieAttributes(command[2]));
      break;
    }
  }
}, "runCookieCommand");
var deserializeCookieAttributes = /* @__PURE__ */ __name((attributes) => ({
  ...attributes,
  expires: typeof attributes.expires === "string" ? new Date(attributes.expires) : attributes.expires
}), "deserializeCookieAttributes");
export {
  CookiesProvider,
  useCookies
};
//# sourceMappingURL=index.mjs.map